<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CloudFrogBot -- Returning to the telegram...</title>
</head>

<body>
  <noscript>
    <h1>REDIRECT FAILED -- Please enable JavaScript</h1>
  </noscript>
</body>

<!--
  Why? The reason is in the Yandex API return format.

  The OAuth server is returning the authorization code in the URL with
  an ampersand (&) followed by the code parameter: &code=CODE.
  However, the Telegram bot API expects the parameter to be passed as
  a value of the start parameter: ?start=<parameter>.

  Having the ampersand causes the start parameter to be treated as empty.

  So, I've set up a redirect page that takes the OAuth callback URL
  with the &code=CODE format and transforms it into the ?start=CODE
  format expected by the Telegram bot before redirecting the user.
-->

<!-- PHP would be better, ngl -->
<script>
  const queryString = window.location.search;
  const urlParams = new URLSearchParams(queryString);
  const code = urlParams.get("code");

  function showPage(h1text, ptext) {
    const h1 = document.createElement("h1");
    h1.innerHTML = h1text;
    document.body.appendChild(h1);

    const p = document.createElement("p");
    p.innerHTML = ptext;
    document.body.appendChild(p);
  }

  // This is the reason why software development is Just(Insanity).
  if (code == null) {
    showPage("CloudFrogBot -- Redirect failed", "The OAuth server did not return a code.");
  } else {
    showPage("CloudFrogBot -- Redirecting...", "Please wait while we redirect you to the Telegram bot.");

    window.location.replace("http://t.me/friendlyfrog_bot?start=" + code);
  }
</script>

</html>
